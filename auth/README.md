

# auth
`import "github.com/ardanlabs/kit/auth"`

* [Overview](#pkg-overview)
* [Index](#pkg-index)
* [Subdirectories](#pkg-subdirectories)

## <a name="pkg-overview">Overview</a>
Package auth package provides API's for managing users who will be accessing
our web API's and applications. This includes all the CRUD related support
for users and authentication. For now the user system is simple since users
are pre-registered using our cli tool `kit`. In the future this can be
expanded to provide more UI based support.

### Users
A user is an entity that can be authenticated on the system and granted rights
to the API's and applications that we build. From an authentication standpoint
several fields from a User document are important:

PublicID  : This is the users public identifier and can be shared with the world.
It provides a unique id for each user. It is used to lookup users from the database.
This is a randomlu generated UUID.

PrivateID : This is the users private identifier and must not be shared with
the world. It is used in conjunction with the user supplied password to create
an encrypted password. To authenticate with a password you need the users
password and this private id. This is a randomlu generated UUID.

Password  : This is a hased value based on a user provided string and the
user's private identifier. These values are combined and encrypted to create
a hash value that is stored in the user document as the password.

A user can be looked up by their public identifier or by email address. The
email address can be used as a username and an index in the collection for
users but make this field unique.

### Sessions
A session is a document in the database tied to a user via their PublicID.
Sessions provide a level of security for web tokens by giving them an expiration
date and a lookup point for the user accessing the API. The SessionID is what
is used to look up the user performing the web call. Though the user's PublicID
is not private, it is not used directly.

### Web Tokens
Access to the different web service API's using kit require sending a web token
on every request. HTTP Basic Authorization is being used:


	Authorization: Basic WebToken

A web token is a value that is not stored in the database but can be consistently
generated by having a user document and a session identifier. It is made up of
two parts, a SessionID and a Token which are concatinated together and then base64
encoded for use over HTTP:


	base64Encode(SessionID:Token)

The SessionID is a randomly generated UUID and is recorded in the sessions
collection. It is tied to a user via their PublicID and has an expiration date:


	SessionID   string
	PublicID    string
	DateExpires time.Time
	DateCreated time.Time

The Token is generated by using the following fields from the user document:


	Password     string
	PublicID     string
	PrivateID    string
	Email        string

The PublicID, PrivateID, Email fields are used to create a Salt that is
combined with the Password to create a signed SHA256 hash value. This is a
value that can be consistenly re-created when all the same values are present.
If any of the fields used in this token change, the token will be invalidated.

### Web Token Authentication
To make things as secure as possible, database lookups are performed as part
of web token authentication. The user must keep their token secure.

Here are the steps to web token authentication:


	* Decode the web token and break it into its parts of SessionID and Token.
	* Retrieve the session document for the SessionID and validate it has not expired.
	* Retrieve the user document from the PublicID in the session document.
	* Validate the Token is valid by generating a new token from the retrieved user document.

If any of these steps fail, authorization fails.

### User Login
This has not been coded yet.




## <a name="pkg-index">Index</a>
* [Constants](#pkg-constants)
* [func CreateUser(context interface{}, db *db.DB, u *User) error](#CreateUser)
* [func CreateWebToken(context interface{}, db *db.DB, u *User, expires time.Duration) (string, error)](#CreateWebToken)
* [func DecodeWebToken(context interface{}, webToken string) (sessionID string, token string, err error)](#DecodeWebToken)
* [func GetUserWebToken(context interface{}, db *db.DB, publicID string) (string, error)](#GetUserWebToken)
* [func GetUsers(context interface{}, db *db.DB, activeOnly bool) ([]User, error)](#GetUsers)
* [func UpdateUser(context interface{}, db *db.DB, uu UpdUser) error](#UpdateUser)
* [func UpdateUserPassword(context interface{}, db *db.DB, u *User, password string) error](#UpdateUserPassword)
* [func UpdateUserStatus(context interface{}, db *db.DB, publicID string, status int) error](#UpdateUserStatus)
* [type NUser](#NUser)
  * [func (nu *NUser) Validate() error](#NUser.Validate)
* [type UpdUser](#UpdUser)
  * [func (uu *UpdUser) Validate() error](#UpdUser.Validate)
* [type User](#User)
  * [func GetUserByEmail(context interface{}, db *db.DB, email string, activeOnly bool) (*User, error)](#GetUserByEmail)
  * [func GetUserByPublicID(context interface{}, db *db.DB, publicID string, activeOnly bool) (*User, error)](#GetUserByPublicID)
  * [func LoginUser(context interface{}, db *db.DB, email string, password string) (*User, error)](#LoginUser)
  * [func NewUser(nu NUser) (*User, error)](#NewUser)
  * [func ValidateWebToken(context interface{}, db *db.DB, webToken string) (*User, error)](#ValidateWebToken)
  * [func (u *User) IsPasswordValid(password string) bool](#User.IsPasswordValid)
  * [func (u *User) Pwd() ([]byte, error)](#User.Pwd)
  * [func (u *User) Salt() ([]byte, error)](#User.Salt)
  * [func (u *User) Validate() error](#User.Validate)
  * [func (u *User) WebToken(sessionID string) (string, error)](#User.WebToken)


#### <a name="pkg-files">Package files</a>
[auth.go](/src/github.com/ardanlabs/kit/auth/auth.go) [doc.go](/src/github.com/ardanlabs/kit/auth/doc.go) [model.go](/src/github.com/ardanlabs/kit/auth/model.go) 


## <a name="pkg-constants">Constants</a>
``` go
const (
    StatusUnknown = iota
    StatusActive
    StatusDisabled
)
```
Set of user status codes.

``` go
const Collection = "auth_users"
```
Collection contains the name of the auth_users collection.




## <a name="CreateUser">func</a> [CreateUser](/src/target/auth.go?s=524:586#L15)
``` go
func CreateUser(context interface{}, db *db.DB, u *User) error
```
CreateUser adds a new user to the database.



## <a name="CreateWebToken">func</a> [CreateWebToken](/src/target/auth.go?s=1194:1293#L38)
``` go
func CreateWebToken(context interface{}, db *db.DB, u *User, expires time.Duration) (string, error)
```
CreateWebToken return a token and session that can be used to authenticate a user.



## <a name="DecodeWebToken">func</a> [DecodeWebToken](/src/target/auth.go?s=2322:2423#L72)
``` go
func DecodeWebToken(context interface{}, webToken string) (sessionID string, token string, err error)
```
DecodeWebToken breaks a web token into its parts.



## <a name="GetUserWebToken">func</a> [GetUserWebToken](/src/target/auth.go?s=6188:6273#L194)
``` go
func GetUserWebToken(context interface{}, db *db.DB, publicID string) (string, error)
```
GetUserWebToken return a token if one exists and is valid.



## <a name="GetUsers">func</a> [GetUsers](/src/target/auth.go?s=7271:7349#L231)
``` go
func GetUsers(context interface{}, db *db.DB, activeOnly bool) ([]User, error)
```
GetUsers retrieves all user records with an optional filter for only active
users.



## <a name="UpdateUser">func</a> [UpdateUser](/src/target/auth.go?s=8010:8075#L256)
``` go
func UpdateUser(context interface{}, db *db.DB, uu UpdUser) error
```
UpdateUser updates an existing user to the database.



## <a name="UpdateUserPassword">func</a> [UpdateUserPassword](/src/target/auth.go?s=8881:8968#L281)
``` go
func UpdateUserPassword(context interface{}, db *db.DB, u *User, password string) error
```
UpdateUserPassword updates an existing user's password and token in the database.



## <a name="UpdateUserStatus">func</a> [UpdateUserStatus](/src/target/auth.go?s=10068:10156#L318)
``` go
func UpdateUserStatus(context interface{}, db *db.DB, publicID string, status int) error
```
UpdateUserStatus changes the status of a user to make them active or disabled.




## <a name="NUser">type</a> [NUser](/src/target/model.go?s=689:1010#L25)
``` go
type NUser struct {
    Status   int    `bson:"status" json:"status" validate:"required,ne=0"`
    FullName string `bson:"full_name" json:"full_name" validate:"required,min=8"`
    Email    string `bson:"email" json:"email" validate:"required,max=100,email"`
    Password string `bson:"password" json:"-" validate:"required,min=8"`
}
```
NUser is provided to create a new user value for use.










### <a name="NUser.Validate">func</a> (\*NUser) [Validate](/src/target/model.go?s=1085:1118#L33)
``` go
func (nu *NUser) Validate() error
```
Validate performs validation on a NUser value before it is processed.




## <a name="UpdUser">type</a> [UpdUser](/src/target/model.go?s=4178:4509#L139)
``` go
type UpdUser struct {
    PublicID string `bson:"public_id" json:"public_id" validate:"required,uuid"`
    Status   int    `bson:"status" json:"status" validate:"required,ne=0"`
    FullName string `bson:"full_name" json:"full_name" validate:"required,min=8"`
    Email    string `bson:"email" json:"email" validate:"required,max=100,email"`
}
```
UpdUser is provided to update an existing user in the system.










### <a name="UpdUser.Validate">func</a> (\*UpdUser) [Validate](/src/target/model.go?s=4586:4621#L147)
``` go
func (uu *UpdUser) Validate() error
```
Validate performs validation on a NewUser value before it is processed.




## <a name="User">type</a> [User](/src/target/model.go?s=1330:2102#L44)
``` go
type User struct {
    ID           bson.ObjectId `bson:"_id,omitempty" json:"-"`
    PublicID     string        `bson:"public_id" json:"public_id" validate:"required,uuid"`
    PrivateID    string        `bson:"private_id" json:"-" validate:"required,uuid"`
    Status       int           `bson:"status" json:"status" validate:"required,ne=0"`
    FullName     string        `bson:"full_name" json:"full_name" validate:"required,min=8"`
    Email        string        `bson:"email" json:"email" validate:"required,max=100,email"`
    Password     string        `bson:"password" json:"-" validate:"required,min=55"`
    IsDeleted    bool          `bson:"is_deleted" json:"-"`
    DateModified time.Time     `bson:"date_modified" json:"-"`
    DateCreated  time.Time     `bson:"date_created" json:"-"`
}
```
User model denotes a user entity for a tenant.







### <a name="GetUserByEmail">func</a> [GetUserByEmail](/src/target/auth.go?s=5405:5502#L169)
``` go
func GetUserByEmail(context interface{}, db *db.DB, email string, activeOnly bool) (*User, error)
```
GetUserByEmail retrieves a user record by using the provided email.


### <a name="GetUserByPublicID">func</a> [GetUserByPublicID](/src/target/auth.go?s=4614:4717#L144)
``` go
func GetUserByPublicID(context interface{}, db *db.DB, publicID string, activeOnly bool) (*User, error)
```
GetUserByPublicID retrieves a user record by using the provided PublicID.


### <a name="LoginUser">func</a> [LoginUser](/src/target/auth.go?s=11086:11178#L346)
``` go
func LoginUser(context interface{}, db *db.DB, email string, password string) (*User, error)
```
LoginUser authenticates the user and if successful returns the User value.


### <a name="NewUser">func</a> [NewUser](/src/target/model.go?s=2156:2193#L58)
``` go
func NewUser(nu NUser) (*User, error)
```
NewUser creates a new user from a NewUser value.


### <a name="ValidateWebToken">func</a> [ValidateWebToken](/src/target/auth.go?s=3229:3314#L100)
``` go
func ValidateWebToken(context interface{}, db *db.DB, webToken string) (*User, error)
```
ValidateWebToken accepts a web token and validates its credibility. Returns
a User value is the token is valid.





### <a name="User.IsPasswordValid">func</a> (\*User) [IsPasswordValid](/src/target/model.go?s=3729:3781#L123)
``` go
func (u *User) IsPasswordValid(password string) bool
```
IsPasswordValid compares the user provided password with what is in the db.




### <a name="User.Pwd">func</a> (\*User) [Pwd](/src/target/model.go?s=2883:2919#L92)
``` go
func (u *User) Pwd() ([]byte, error)
```
Pwd implements the secure entity interface.




### <a name="User.Salt">func</a> (\*User) [Salt](/src/target/model.go?s=3083:3120#L101)
``` go
func (u *User) Salt() ([]byte, error)
```
Salt implements the secure entity interface.




### <a name="User.Validate">func</a> (\*User) [Validate](/src/target/model.go?s=2726:2757#L83)
``` go
func (u *User) Validate() error
```
Validate performs validation on a CrtUser value before it is processed.




### <a name="User.WebToken">func</a> (\*User) [WebToken](/src/target/model.go?s=3387:3444#L112)
``` go
func (u *User) WebToken(sessionID string) (string, error)
```
WebToken returns a token ready for web use.








- - -
Generated by [godoc2md](http://godoc.org/github.com/davecheney/godoc2md)
